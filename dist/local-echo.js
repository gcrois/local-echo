(()=>{var Y=Object.create;var H=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var tt=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty;var T=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var rt=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of X(t))!et.call(i,s)&&s!==e&&H(i,s,{get:()=>t[s],enumerable:!(r=Z(t,s))||r.enumerable});return i};var it=(i,t,e)=>(e=i!=null?Y(tt(i)):{},rt(t||!i||!i.__esModule?H(e,"default",{value:i,enumerable:!0}):e,i));var $=T((ft,W)=>{"use strict";W.exports=function(t){return t.map(function(e){return e&&typeof e=="object"?e.op.replace(/(.)/g,"\\$1"):/["\s]/.test(e)&&!/'/.test(e)?"'"+e.replace(/(['\\])/g,"\\$1")+"'":/["'\s]/.test(e)?'"'+e.replace(/(["\\$`!])/g,"\\$1")+'"':String(e).replace(/([A-Za-z]:)?([#!"$&'()*,:;<=>?@[\\\]^`{|}])/g,"$1\\$2")}).join(" ")}});var Q=T((dt,q)=>{"use strict";var N="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(","\\<\\<\\<",">>",">\\&","<\\&","[&;()|<>]"].join("|")+")",L=new RegExp("^"+N+"$"),M="|&;()<> \\t",st='"((\\\\"|[^"])*?)"',nt="'((\\\\'|[^'])*?)'",ot=/^#$/,F="'",j='"',R="$",d="",ht=4294967296;for(E=0;E<4;E++)d+=(ht*Math.random()).toString(16);var E,at=new RegExp("^"+d);function lt(i,t){for(var e=t.lastIndex,r=[],s;s=t.exec(i);)r.push(s),t.lastIndex===s.index&&(t.lastIndex+=1);return t.lastIndex=e,r}function ut(i,t,e){var r=typeof i=="function"?i(e):i[e];return typeof r>"u"&&e!=""?r="":typeof r>"u"&&(r="$"),typeof r=="object"?t+d+JSON.stringify(r)+d:t+r}function ct(i,t,e){e||(e={});var r=e.escape||"\\",s="(\\"+r+`['"`+M+`]|[^\\s'"`+M+"])+",a=new RegExp(["("+N+")","("+s+"|"+st+"|"+nt+")+"].join("|"),"g"),h=lt(i,a);if(h.length===0)return[];t||(t={});var n=!1;return h.map(function(l){var o=l[0];if(!o||n)return;if(L.test(o))return{op:o};var u=!1,C=!1,m="",P=!1,p;function D(){p+=1;var f,g,y=o.charAt(p);if(y==="{"){if(p+=1,o.charAt(p)==="}")throw new Error("Bad substitution: "+o.slice(p-2,p+1));if(f=o.indexOf("}",p),f<0)throw new Error("Bad substitution: "+o.slice(p));g=o.slice(p,f),p=f}else if(/[*@#?$!_-]/.test(y))g=y,p+=1;else{var A=o.slice(p);f=A.match(/[^\w\d_]/),f?(g=A.slice(0,f.index),p+=f.index-1):(g=A,p=o.length)}return ut(t,"",g)}for(p=0;p<o.length;p++){var c=o.charAt(p);if(P=P||!u&&(c==="*"||c==="?"),C)m+=c,C=!1;else if(u)c===u?u=!1:u==F?m+=c:c===r?(p+=1,c=o.charAt(p),c===j||c===r||c===R?m+=c:m+=r+c):c===R?m+=D():m+=c;else if(c===j||c===F)u=c;else{if(L.test(c))return{op:o};if(ot.test(c)){n=!0;var O={comment:i.slice(l.index+p+1)};return m.length?[m,O]:[O]}else c===r?C=!0:c===R?m+=D():m+=c}}return P?{op:"glob",pattern:m}:m}).reduce(function(l,o){return typeof o>"u"?l:l.concat(o)},[])}q.exports=function(t,e,r){var s=ct(t,e,r);return typeof e!="function"?s:s.reduce(function(a,h){if(typeof h=="object")return a.concat(h);var n=h.split(RegExp("("+d+".*?"+d+")","g"));return n.length===1?a.concat(n[0]):a.concat(n.filter(Boolean).map(function(l){return at.test(l)?JSON.parse(l.split(d)[1]):l}))},[])}});var U=T(I=>{"use strict";I.quote=$();I.parse=Q()});var _=class{size;entries;cursor;constructor(t){this.size=t,this.entries=[],this.cursor=0}push(t){if(t.trim()==="")return;let e=this.entries[this.entries.length-1];t!==e&&(this.entries.push(t),this.entries.length>this.size&&this.entries.shift(),this.cursor=this.entries.length)}rewind(){this.cursor=this.entries.length}getPrevious(){let t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]}getNext(){let t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]}};var z=it(U());function K(i,t=!0){let e,r=[],s=/\w+/g;for(;e=s.exec(i);)r.push(t?e.index:e.index+e[0].length);return r}function S(i,t){return K(i,!0).reverse().find(r=>r<t)??0}function G(i,t){return K(i,!1).find(r=>r>t)??i.length}function v(i,t,e){let r=0,s=0;for(let a=0;a<t;++a)i.charAt(a)===`
`?(s=0,r+=1):(s+=1,s>e&&(s=0,r+=1));return{row:r,col:s}}function x(i,t){return v(i,i.length,t).row+1}function J(i){return i.trim()===""?!1:(i.match(/'/g)||[]).length%2!==0||(i.match(/"/g)||[]).length%2!==0||i.split(/(\|\||\||&&)/g).pop()?.trim()===""?!0:i.endsWith("\\")&&!i.endsWith("\\\\")}function w(i){return/[^\\][ \t]$/m.test(i)}function k(i){return i.trim()===""||w(i)?"":(0,z.parse)(i).pop()||""}function V(i,t){let e=(0,z.parse)(t),r=e.length-1,s=e[r]||"";return t.trim()===""?(r=0,s=""):w(t)&&(r+=1,s=""),i.reduce((a,{fn:h,args:n})=>{try{return a.concat(h(r,e,...n))}catch(l){return console.error("Auto-complete error:",l),a}},[]).filter(a=>a.startsWith(s))}function B(i,t){if(i.length>=t[0].length)return i;let e=i;i+=t[0].slice(i.length,i.length+1);for(let r=0;r<t.length;r++){if(!t[r].startsWith(e))return null;if(!t[r].startsWith(i))return e}return B(i,t)}var b=class{term;history;maxAutocompleteEntries;_autocompleteHandlers;_active;_input;_cursor;_activePrompt;_activeCharPrompt;_termSize;_disposables;_handleTermData;_handleTermResize;constructor(t=null,e={}){this.term=t,this._handleTermData=this.handleTermData.bind(this),this._handleTermResize=this.handleTermResize.bind(this),this.history=new _(e.historySize||10),this.maxAutocompleteEntries=e.maxAutocompleteEntries||100,this._autocompleteHandlers=[],this._active=!1,this._input="",this._cursor=0,this._activePrompt=null,this._activeCharPrompt=null,this._termSize={cols:0,rows:0},this._disposables=[],t&&("loadAddon"in t?t.loadAddon(this):this.attach())}activate(t){this.term=t,this.attach()}dispose(){this.detach()}detach(){this.term&&"off"in this.term?(this.term.off("data",this._handleTermData),this.term.off("resize",this._handleTermResize)):(this._disposables.forEach(t=>t.dispose()),this._disposables=[])}attach(){this.term&&"on"in this.term?(this.term.on("data",this._handleTermData),this.term.on("resize",this._handleTermResize)):this.term&&(this._disposables.push(this.term.onData(this._handleTermData)),this._disposables.push(this.term.onResize(this._handleTermResize))),this._termSize={cols:this.term?this.term.cols:0,rows:this.term?this.term.rows:0}}addAutocompleteHandler(t,...e){this._autocompleteHandlers.push({fn:t,args:e})}removeAutocompleteHandler(t){let e=this._autocompleteHandlers.findIndex(r=>r.fn===t);e!==-1&&this._autocompleteHandlers.splice(e,1)}read(t,e="> "){return new Promise((r,s)=>{this.term&&this.term.write(t),this._activePrompt={prompt:t,continuationPrompt:e,resolve:r,reject:s},this._input="",this._cursor=0,this._active=!0})}readChar(t){return new Promise((e,r)=>{this.term&&this.term.write(t),this._activeCharPrompt={prompt:t,resolve:e,reject:r}})}abortRead(t="aborted"){(this._activePrompt!=null||this._activeCharPrompt!=null)&&this.term&&this.term.write(`\r
`),this._activePrompt!=null&&(this._activePrompt.reject(t),this._activePrompt=null),this._activeCharPrompt!=null&&(this._activeCharPrompt.reject(t),this._activeCharPrompt=null),this._active=!1}println(t){this.print(t+`
`)}print(t){let e=t.replace(/[\r\n]+/g,`
`);this.term&&this.term.write(e.replace(/\n/g,`\r
`))}printWide(t,e=2){if(t.length==0)return this.println("");let r=t.reduce((n,l)=>Math.max(n,l.length),0)+e,s=Math.floor(this._termSize.cols/r),a=Math.ceil(t.length/s),h=0;for(let n=0;n<a;++n){let l="";for(let o=0;o<s;++o)if(h<t.length){let u=t[h++];u+=" ".repeat(r-u.length),l+=u}this.println(l)}}applyPrompts(t){let e=(this._activePrompt||{}).prompt||"",r=(this._activePrompt||{}).continuationPrompt||"";return e+t.replace(/\n/g,`
`+r)}applyPromptOffset(t,e){return this.applyPrompts(t.substr(0,e)).length}clearInput(){let t=this.applyPrompts(this._input),e=x(t,this._termSize.cols),r=this.applyPromptOffset(this._input,this._cursor),{col:s,row:a}=v(t,r,this._termSize.cols),h=e-a-1;for(var n=0;n<h;++n)this.term&&this.term.write("\x1B[E");if(this.term){this.term.write("\r\x1B[K");for(var n=1;n<e;++n)this.term.write("\x1B[F\x1B[K")}}setInput(t,e=!0){e&&this.clearInput();let r=this.applyPrompts(t);this.print(r),this._cursor>t.length&&(this._cursor=t.length);let s=this.applyPromptOffset(t,this._cursor),a=x(r,this._termSize.cols),{col:h,row:n}=v(r,s,this._termSize.cols),l=a-n-1;if(this.term){this.term.write("\r");for(var o=0;o<l;++o)this.term.write("\x1B[F");for(var o=0;o<h;++o)this.term.write("\x1B[C")}this._input=t}printAndRestartPrompt(t){let e=this._cursor;this.setCursor(this._input.length),this.term&&this.term.write(`\r
`);let r=()=>{this._cursor=e,this.setInput(this._input)},s=t();s==null?r():s.then(r)}setCursor(t){t<0&&(t=0),t>this._input.length&&(t=this._input.length);let e=this.applyPrompts(this._input),r=x(e,this._termSize.cols),s=this.applyPromptOffset(this._input,this._cursor),{col:a,row:h}=v(e,s,this._termSize.cols),n=this.applyPromptOffset(this._input,t),{col:l,row:o}=v(e,n,this._termSize.cols);if(this.term){if(o>h)for(let u=h;u<o;++u)this.term.write("\x1B[B");else for(let u=o;u<h;++u)this.term.write("\x1B[A");if(l>a)for(let u=a;u<l;++u)this.term.write("\x1B[C");else for(let u=l;u<a;++u)this.term.write("\x1B[D")}this._cursor=t}handleCursorMove(t){if(t>0){let e=Math.min(t,this._input.length-this._cursor);this.setCursor(this._cursor+e)}else if(t<0){let e=Math.max(t,-this._cursor);this.setCursor(this._cursor+e)}}handleCursorErase(t){let{_cursor:e,_input:r}=this;if(t){if(e<=0)return;let s=r.substr(0,e-1)+r.substr(e);this.clearInput(),this._cursor-=1,this.setInput(s,!1)}else{let s=r.substr(0,e)+r.substr(e+1);this.setInput(s)}}handleCursorInsert(t){let{_cursor:e,_input:r}=this,s=r.substr(0,e)+t+r.substr(e);this._cursor+=t.length,this.setInput(s)}handleReadComplete(){this.history&&this.history.push(this._input),this._activePrompt&&(this._activePrompt.resolve(this._input),this._activePrompt=null),this.term&&this.term.write(`\r
`),this._active=!1}handleTermResize(t){let{rows:e,cols:r}=t;this.clearInput(),this._termSize={cols:r,rows:e},this.setInput(this._input,!1)}handleTermData(t){if(this._active){if(this._activeCharPrompt!=null){this._activeCharPrompt.resolve(t),this._activeCharPrompt=null,this.term&&this.term.write(`\r
`);return}if(t.length>3&&t.charCodeAt(0)!==27){let e=t.replace(/[\r\n]+/g,"\r");Array.from(e).forEach(r=>this.handleData(r))}else this.handleData(t)}}handleData(t){if(!this._active)return;let e=t.charCodeAt(0),r;if(e==27)switch(t.substr(1)){case"[A":if(this.history){let s=this.history.getPrevious();s&&(this.setInput(s),this.setCursor(s.length))}break;case"[B":if(this.history){let s=this.history.getNext();s||(s=""),this.setInput(s),this.setCursor(s.length)}break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this._input.length);break;case"[H":this.setCursor(0);break;case"b":r=S(this._input,this._cursor),r!=null&&this.setCursor(r);break;case"f":r=G(this._input,this._cursor),r!=null&&this.setCursor(r);break;case"\x7F":r=S(this._input,this._cursor),r!=null&&(this.setInput(this._input.substr(0,r)+this._input.substr(this._cursor)),this.setCursor(r));break}else if(e<32||e===127)switch(t){case"\r":J(this._input)?this.handleCursorInsert(`
`):this.handleReadComplete();break;case"\x7F":this.handleCursorErase(!0);break;case"	":if(this._autocompleteHandlers.length>0){let s=this._input.substr(0,this._cursor),a=w(s),h=V(this._autocompleteHandlers,s);if(h.sort(),h.length===0)a||this.handleCursorInsert(" ");else if(h.length===1){let n=k(s);this.handleCursorInsert(h[0].substr(n.length)+" ")}else if(h.length<=this.maxAutocompleteEntries){let n=B(s,h);if(n){let l=k(s);this.handleCursorInsert(n.substr(l.length))}this.printAndRestartPrompt(()=>{this.printWide(h)})}else this.printAndRestartPrompt(()=>this.readChar(`Display all ${h.length} possibilities? (y or n)`).then(n=>{(n=="y"||n=="Y")&&this.printWide(h)}))}else this.handleCursorInsert("    ");break;case"":this.setCursor(this._input.length),this.term&&this.term.write(`^C\r
`+((this._activePrompt||{}).prompt||"")),this._input="",this._cursor=0,this.history&&this.history.rewind();break}else this.handleCursorInsert(t)}};var Pt=b;})();
//# sourceMappingURL=local-echo.js.map
